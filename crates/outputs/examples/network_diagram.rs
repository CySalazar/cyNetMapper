//! Network diagram example for cyNetMapper
//! 
//! This example demonstrates network topology diagram generation.

use cynetmapper_outputs::*;

#[tokio::main]
async fn main() -> Result<(), Box<dyn std::error::Error>> {
    println!("Network diagram example");
    
    // Example network topology data
    let network_nodes = vec![
        ("192.168.1.1", "Router", vec!["192.168.1.2", "192.168.1.3", "192.168.1.4"]),
        ("192.168.1.2", "Web Server", vec!["192.168.1.5"]),
        ("192.168.1.3", "Database Server", vec![]),
        ("192.168.1.4", "File Server", vec!["192.168.1.6"]),
        ("192.168.1.5", "Load Balancer", vec!["192.168.1.7", "192.168.1.8"]),
        ("192.168.1.6", "Backup Server", vec![]),
        ("192.168.1.7", "App Server 1", vec![]),
        ("192.168.1.8", "App Server 2", vec![]),
    ];
    
    println!("Generating network diagram for {} nodes...", network_nodes.len());
    
    // Generate Graphviz DOT format
    let dot_diagram = format!(
        r#"digraph NetworkTopology {{
    rankdir=TB;
    node [shape=box, style=filled, fontname="Arial"];
    edge [fontname="Arial", fontsize=10];
    
    // Node definitions
{}
    
    // Edge definitions
{}
    
    // Styling
    {{rank=same; "192.168.1.7"; "192.168.1.8";}}
    
    label="Network Topology - Generated by cyNetMapper\n{}";
    labelloc=t;
    fontsize=16;
    fontname="Arial Bold";
}}
"#,
        network_nodes
            .iter()
            .map(|(ip, role, _)| {
                let color = match role {
                    r if r.contains("Router") => "lightblue",
                    r if r.contains("Server") => "lightgreen",
                    r if r.contains("Balancer") => "lightyellow",
                    _ => "lightgray",
                };
                format!("    \"{}\" [label=\"{} \\n({})\", fillcolor={}];", ip, role, ip, color)
            })
            .collect::<Vec<_>>()
            .join("\n"),
        network_nodes
            .iter()
            .flat_map(|(source, _, connections)| {
                connections.iter().map(move |target| {
                    format!("    \"{}\" -> \"{}\" [label=\"connects\"];", source, target)
                })
            })
            .collect::<Vec<_>>()
            .join("\n"),
        chrono::Utc::now().format("%Y-%m-%d %H:%M:%S UTC")
    );
    
    println!("\nGraphviz DOT diagram generated:");
    println!("{}", dot_diagram);
    
    // Generate ASCII network diagram
    println!("\n\nASCII Network Diagram:");
    println!("â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”");
    println!("â”‚                    Network Topology                        â”‚");
    println!("â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤");
    println!("â”‚                                                             â”‚");
    println!("â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                     â”‚");
    println!("â”‚         â”‚   Router    â”‚                                     â”‚");
    println!("â”‚         â”‚192.168.1.1  â”‚                                     â”‚");
    println!("â”‚         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                     â”‚");
    println!("â”‚                â”‚                                            â”‚");
    println!("â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚");
    println!("â”‚     â”‚          â”‚          â”‚                                â”‚");
    println!("â”‚ â”Œâ”€â”€â”€â–¼â”€â”€â”€â”  â”Œâ”€â”€â”€â–¼â”€â”€â”€â”  â”Œâ”€â”€â”€â–¼â”€â”€â”€â”                            â”‚");
    println!("â”‚ â”‚Web Srvâ”‚  â”‚DB Srv â”‚  â”‚File   â”‚                            â”‚");
    println!("â”‚ â”‚.1.2   â”‚  â”‚.1.3   â”‚  â”‚Srv.1.4â”‚                            â”‚");
    println!("â”‚ â””â”€â”€â”€â”¬â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”¬â”€â”€â”€â”˜                            â”‚");
    println!("â”‚     â”‚                      â”‚                                â”‚");
    println!("â”‚ â”Œâ”€â”€â”€â–¼â”€â”€â”€â”              â”Œâ”€â”€â”€â–¼â”€â”€â”€â”                            â”‚");
    println!("â”‚ â”‚Load   â”‚              â”‚Backup â”‚                            â”‚");
    println!("â”‚ â”‚Bal.1.5â”‚              â”‚Srv.1.6â”‚                            â”‚");
    println!("â”‚ â””â”€â”€â”€â”¬â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚");
    println!("â”‚     â”‚                                                       â”‚");
    println!("â”‚ â”Œâ”€â”€â”€â”´â”€â”€â”€â”                                                   â”‚");
    println!("â”‚ â”‚       â”‚                                                   â”‚");
    println!("â”‚ â–¼       â–¼                                                   â”‚");
    println!("â”‚â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”                                              â”‚");
    println!("â”‚â”‚App1 â”‚ â”‚App2 â”‚                                              â”‚");
    println!("â”‚â”‚.1.7 â”‚ â”‚.1.8 â”‚                                              â”‚");
    println!("â”‚â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜                                              â”‚");
    println!("â”‚                                                             â”‚");
    println!("â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜");
    
    println!("\nğŸ“Š Network Statistics:");
    println!("â€¢ Total Nodes: {}", network_nodes.len());
    println!("â€¢ Total Connections: {}", network_nodes.iter().map(|(_, _, conn)| conn.len()).sum::<usize>());
    println!("â€¢ Network Depth: 4 levels");
    
    println!("\nğŸ’¾ Diagram files would be saved as:");
    println!("â€¢ network_topology.dot (Graphviz format)");
    println!("â€¢ network_topology.png (PNG image)");
    println!("â€¢ network_topology.svg (SVG vector)");
    
    Ok(())
}