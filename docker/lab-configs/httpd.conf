# Apache HTTP Server Configuration for cyNetMapper Lab

ServerRoot "/usr/local/apache2"
Listen 80

# Modules
LoadModule mpm_event_module modules/mod_mpm_event.so
LoadModule authz_core_module modules/mod_authz_core.so
LoadModule dir_module modules/mod_dir.so
LoadModule mime_module modules/mod_mime.so
LoadModule rewrite_module modules/mod_rewrite.so
LoadModule headers_module modules/mod_headers.so
LoadModule alias_module modules/mod_alias.so
LoadModule status_module modules/mod_status.so
LoadModule info_module modules/mod_info.so

# Basic settings
ServerName lab-apache:80
ServerTokens Prod
ServerSignature Off

# Directory settings
<Directory "/">
    AllowOverride none
    Require all denied
</Directory>

DocumentRoot "/usr/local/apache2/htdocs"
<Directory "/usr/local/apache2/htdocs">
    Options Indexes FollowSymLinks
    AllowOverride None
    Require all granted
</Directory>

# Directory index
DirectoryIndex index.html

# MIME types
TypesConfig conf/mime.types

# Logging
ErrorLog /proc/self/fd/2
LogLevel warn
LogFormat "%h %l %u %t \"%r\" %>s %O \"%{Referer}i\" \"%{User-Agent}i\"" combined
CustomLog /proc/self/fd/1 combined

# Custom headers for testing
Header always set X-Lab-Server "apache-test"
Header always set X-Scan-Test "cynetmapper-lab"

# Virtual host for testing
<VirtualHost *:80>
    ServerName lab-apache
    DocumentRoot "/usr/local/apache2/htdocs"
    
    # API endpoint
    Alias /api /usr/local/apache2/htdocs/api
    <Directory "/usr/local/apache2/htdocs/api">
        Options None
        AllowOverride None
        Require all granted
        
        # Return JSON for API calls
        RewriteEngine On
        RewriteRule ^.*$ - [E=HTTP_CONTENT_TYPE:application/json]
        Header always set Content-Type "application/json"
    </Directory>
    
    # Health check endpoint
    Alias /health /usr/local/apache2/htdocs/health.txt
    
    # Status endpoints for testing
    Alias /status/200 /usr/local/apache2/htdocs/status200.txt
    Alias /status/404 /usr/local/apache2/htdocs/nonexistent.txt
    
    # Server status (for testing)
    <Location "/server-status">
        SetHandler server-status
        Require all granted
    </Location>
    
    # Server info (for testing)
    <Location "/server-info">
        SetHandler server-info
        Require all granted
    </Location>
</VirtualHost>

# Security headers
Header always set X-Content-Type-Options nosniff
Header always set X-Frame-Options DENY
Header always set X-XSS-Protection "1; mode=block"

# Hide Apache version in error pages
ServerTokens Prod